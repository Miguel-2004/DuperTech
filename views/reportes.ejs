<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('includes/head') %> 
    <title><%= pageTitle %></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        .chart-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        canvas {
            max-height: 300px;
            width: 100%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <%- include('includes/sidebar') %> 

    <section class="section">
        <div class="container">
            <div class="columns is-multiline is-centered">
                <!-- Gráfica de Sellos por Empleado -->
                <div class="column is-half">
                    <div class="box">
                        <h1 class="title has-text-centered">Reporte de Sellos por Empleado</h1>
                        <div class="chart-container">
                            <canvas id="sellosChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Gráfica de Promociones Canjeadas a lo Largo del Tiempo -->
                <div class="column is-half">
                    <div class="box">
                        <h1 class="title has-text-centered">Promociones Canjeadas a lo Largo del Tiempo</h1>
                        <div class="chart-container">
                            <canvas id="promocionesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Gráfica de Tarjetas por Sucursal -->
                <div class="column is-half">
                    <div class="box">
                        <h1 class="title has-text-centered">Tarjetas por Sucursal</h1>
                        <div class="chart-container">
                            <canvas id="tarjetasChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Gráfica de Sellos por Sucursal (Gráfica de Pastel) -->
                <div class="column is-half">
                    <div class="box">
                        <h1 class="title has-text-centered">Sellos Otorgados por Sucursal</h1>
                        <div class="chart-container">
                            <canvas id="sellosPorSucursalChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Script para la gráfica de Sellos por Empleado -->
    <script>
        const ctxSellosChart = document.getElementById('sellosChart').getContext('2d');
        const sellosEmpleadoData = <%- JSON.stringify(sellosPorEmpleado || []) %>;

        if (sellosEmpleadoData.length > 0) {
            const empleadosLabels = sellosEmpleadoData.map(sello => sello.Nombre_Empleado);
            const empleadosData = sellosEmpleadoData.map(sello => sello.Total_Sellos);

            new Chart(ctxSellosChart, {
                type: 'bar',
                data: {
                    labels: empleadosLabels,
                    datasets: [{
                        label: 'Sellos por Empleado',
                        data: empleadosData,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: 'Empleados', font: { size: 16 } }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Sellos', font: { size: 16 } }
                        }
                    }
                }
            });
        } else {
            console.warn('No hay datos disponibles para la gráfica de sellos por empleado.');
        }
    </script>

    <!-- Script para la gráfica de Promociones Canjeadas -->
    <script>
        const ctxPromociones = document.getElementById('promocionesChart').getContext('2d');
        const promocionesData = <%- JSON.stringify(reclamaciones || []) %>;
    
        const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    
        if (promocionesData.length > 0) {
            const fechas = promocionesData.map(promo => {
                const [year, month] = promo.mes.split('-'); 
                return meses[parseInt(month, 10) - 1] + ' ' + year;
            });
    
            const canjeadas = promocionesData.map(promo => promo.canjeadas);
    
            new Chart(ctxPromociones, {
                type: 'line',
                data: {
                    labels: fechas,
                    datasets: [{
                        label: 'Promociones Canjeadas',
                        data: canjeadas,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false,
                        pointRadius: 5
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: 'Mes', font: { size: 16 } }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Cantidad canjeadas', font: { size: 16 } }
                        }
                    }
                }
            });
        } else {
            console.warn('No hay datos disponibles para la gráfica de promociones.');
        }
    </script>
    
    <!-- Script para la gráfica de Tarjetas por Sucursal -->
    <script>
        const ctxTarjetas = document.getElementById('tarjetasChart').getContext('2d');
        const tarjetasData = <%- JSON.stringify(tarjetasPorSucursal || []) %>;

        if (tarjetasData.length > 0) {
            const sucursales = tarjetasData.map(tarjeta => tarjeta.Nombre_Establecimiento);
            const totalTarjetas = tarjetasData.map(tarjeta => tarjeta.Total_Tarjetas);

            new Chart(ctxTarjetas, {
                type: 'bar',
                data: {
                    labels: sucursales,
                    datasets: [{
                        label: 'Total de Tarjetas por Establecimiento',
                        data: totalTarjetas,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: 'Sucursales', font: { size: 16 } }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Tarjetas', font: { size: 16 } }
                        }
                    }
                }
            });
        } else {
            console.warn('No hay datos disponibles para la gráfica de tarjetas por sucursal.');
        }
    </script>

    <!-- Script para la gráfica de Sellos por Sucursal -->
    <script>
        const ctxSellosPorSucursal = document.getElementById('sellosPorSucursalChart').getContext('2d');
        const sellosSucursalData = <%- JSON.stringify(sellosPorSucursal || []) %>;

        if (sellosSucursalData.length > 0) {
            const nombresSucursales = sellosSucursalData.map(sello => sello.Nombre_Establecimiento);
            const totalSellosSucursal = sellosSucursalData.map(sello => sello.Total_Sellos);

            new Chart(ctxSellosPorSucursal, {
                type: 'pie',
                data: {
                    labels: nombresSucursales,
                    datasets: [{
                        label: 'Total de Sellos por Sucursal',
                        data: totalSellosSucursal,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sellos otorgados por sucursal'
                        },
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        } else {
            console.warn('No hay datos disponibles para mostrar en la gráfica de sellos por sucursal.');
        }
    </script>

    <%- include('includes/footer') %>
</body>
</html>
